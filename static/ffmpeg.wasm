/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/@ffmpeg.wasm/main@0.13.1/dist/index.mjs
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var e="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function t(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}var n=t,o=r;function i(e){if(n===setTimeout)return setTimeout(e,0);if((n===t||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}"function"==typeof e.setTimeout&&(n=setTimeout),"function"==typeof e.clearTimeout&&(o=clearTimeout);var s,l=[],a=!1,c=-1;function u(){a&&s&&(a=!1,s.length?l=s.concat(l):c=-1,l.length&&h())}function h(){if(!a){var e=i(u);a=!0;for(var t=l.length;t;){for(s=l,l=[];++c<t;)s&&s[c].run();c=-1,t=l.length}s=null,a=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===r||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{return o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}f.prototype.run=function(){this.fun.apply(null,this.array)};function m(){}var d=m,g=m,p=m,w=m,y=m,v=m,b=m;var x=e.performance||{},E=x.now||x.mozNow||x.msNow||x.oNow||x.webkitNow||function(){return(new Date).getTime()};var T=new Date;var F={nextTick:function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new f(e,t)),1!==l.length||a||i(h)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:d,addListener:g,once:p,off:w,removeListener:y,removeAllListeners:v,emit:b,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*E.call(x),r=Math.floor(t),n=Math.floor(t%1*1e9);return e&&(r-=e[0],(n-=e[1])<0&&(r--,n+=1e9)),[r,n]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-T)/1e3}},k=Object.defineProperty,O=Object.getOwnPropertySymbols,_=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable,$=(e,t,r)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,A=(e,t)=>{for(var r in t||(t={}))_.call(t,r)&&$(e,r,t[r]);if(O)for(var r of O(t))P.call(t,r)&&$(e,r,t[r]);return e},j=(e,t,r)=>($(e,"symbol"!=typeof t?t+"":t,r),r),N=(e,t,r)=>new Promise(((n,o)=>{var i=e=>{try{l(r.next(e))}catch(e){o(e)}},s=e=>{try{l(r.throw(e))}catch(e){o(e)}},l=e=>e.done?n(e.value):Promise.resolve(e.value).then(i,s);l((r=r.apply(e,t)).next())})),S={core:"@ffmpeg.wasm/core-mt",coreOptions:{},defaultArgs:["-nostdin","-y","-hide_banner"],log:!1,logger:(e,...t)=>{var r;return"debug"!==e||"development"===(null==(r=null==F?void 0:F.env)?void 0:r.NODE_ENV)&&console[e](`[${e}] `,...t)}},L=(e,t)=>N(void 0,null,(function*(){switch(typeof e){case"string":return t("debug",`Import '${e}' with esm dynamic import()`),(yield import(e)).default;case"function":return t("debug","FFmpeg core constructor detected, use it directly"),e;default:throw new Error(`Invalid type of option core: ${typeof e}, expect string or function`)}})),D=(e,t,r)=>{let n=e instanceof Error?null==e?void 0:e.message:e;r("error",`Failed to execute '${t.join(" ")}': `,n)},M=/^ffmpeg\sversion\s([^\s]+)/m,U=/^\s*configuration:\s(.+)$/m,B=/^\s*(\w+)\s*(\d+)\.\s*(\d+)\.\s*(\d+)\s*\/.*$/gm;function I(e){var t,r,n,o;return{version:null!=(r=null==(t=e.match(M))?void 0:t[1])?r:"unknown",configuration:null!=(o=null==(n=e.match(U))?void 0:n[1])?o:"",libs:Object.fromEntries([...e.matchAll(B)].map((([,e,t,r,n])=>[e,`${t}.${r}.${n}`]))),raw:e}}var R=(e,t)=>{let r=e._malloc(t.length*Uint32Array.BYTES_PER_ELEMENT);return t.forEach(((t,n)=>{let o=e.lengthBytesUTF8(t)+1,i=e._malloc(o);e.stringToUTF8(t,i,o),e.setValue(r+Uint32Array.BYTES_PER_ELEMENT*n,i,"i32")})),r},V=["ffmpeg","-version"],z=class e{constructor(e,t,r){j(this,"flags"),j(this,"fs"),j(this,"version"),j(this,"core"),j(this,"_exited",!1),j(this,"exec"),j(this,"execAsync"),j(this,"options"),j(this,"tasks",new Map),this.core=e,this.options=t,this.version={main:"0.13.1",core:r};let{simd:n,thread:o,wasi:i}=e;this.flags={simd:n,thread:o,wasi:i},this.exec=e.cwrap("exec","number",["number","number"]),this.execAsync=e.cwrap("execAsync","number",["number","number","number","number"]),this.fs=e.FS}get exited(){return this._exited}static create(){return N(this,arguments,(function*(t={}){var r;let n=A(A({},S),t);null!=(r=n.coreOptions).locateFile||(r.locateFile=(e,t)=>n.coreOptions.wasmPath&&e.endsWith(".wasm")?n.coreOptions.wasmPath:n.coreOptions.workerPath&&e.endsWith(".js")?n.coreOptions.workerPath:`${t}${e}`);let{log:o,logger:i}=n,s="";n.log=!0,n.logger=(e,t)=>{"info"===e&&(s+=`${String(t)}\n`)};let l=yield(yield L(n.core,i))({arguments:V,locateFile:n.coreOptions.locateFile,noExitRuntime:!0,print(e){n.log&&n.logger("info",e)},printErr(e){n.log&&n.logger("error",e)}}),a=I(s);return n.log=o,n.logger=i,new e(l,n,a)}))}run(...e){return N(this,null,(function*(){var t;if(this._exited)throw new Error("FFmpeg core has already been exited!");let r,n,o,i=["ffmpeg",...this.options.defaultArgs,...e],s=Symbol("development"===(null==(t=null==F?void 0:F.env)?void 0:t.NODE_ENV)?`FFmpeg convert ${i.join(" ")}`:"");try{let e=new Promise(((t,l)=>{r=R(this.core,i),n=this.core.addFunction(t,"vi"),o=this.core.addFunction(l,"vi"),this.core.thread?(this.execAsync(i.length,r,n,o)||l("Failed to add task into queue!"),this.tasks.set(s,{get promise(){return e},reject:l})):t(this.exec(i.length,r))}));return yield e}catch(e){throw D(e,i,this.options.logger),e}finally{this.tasks.delete(s),r&&this.core._free(r)}}))}runSync(...e){if(this._exited)throw new Error("FFmpeg core has already been exited!");let t=["ffmpeg",...e],r=R(this.core,t);try{return this.exec(t.length,r)}catch(e){throw D(e,t,this.options.logger),e}finally{this.core._free(r)}}exit(e="kill"){switch(this._exited=!0,e){case"wait":return Promise.allSettled(Array.from(this.tasks.values()).map((({promise:e})=>e))).then((()=>this.core.exit()));case"kill":this.tasks.forEach((({reject:e})=>e("ffmpeg core has exited!")));break;default:if(0!==this.tasks.size)return this.options.logger("warn","Task list is not empty, break."),!1}return this.core.exit()}setLogging(e){this.options.log=e}setLogger(e){this.options.logger=e}};export{z as FFmpeg,L as importCore,D as logError,I as parseVersion,R as writeArgs};export default null;
//# sourceMappingURL=/sm/1d00d6fc8e97f0cdcc251f35341d3b560c6efbddb56ef8ca9d21ddb329d39e38.map